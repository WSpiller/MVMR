<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivariable MR Tutorial • MVMR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivariable MR Tutorial">
<meta property="og:description" content="MVMR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MVMR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/MVMR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/WSpiller/MVMR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MVMR_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivariable MR Tutorial</h1>
                        <h4 class="author">Wes Spiller, Eleanor Sanderson, and Jack Bowden</h4>
            
            <h4 class="date">31<sup>st</sup> January 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/WSpiller/MVMR/blob/master/vignettes/MVMR.rmd"><code>vignettes/MVMR.rmd</code></a></small>
      <div class="hidden name"><code>MVMR.rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Multivariable Mendelian Randomisation (MVMR) is a form of instrumental variable analysis which estimates the direct effect of multiple exposures on an outcome using genetic variants as instruments. The <code>MVMR</code> R package facilitates estimation of causal effects using MVMR, as well as including a range of sensitivity analyses evaluating the underlying assumptions of the approach. The methods included in <code>MVMR</code> originate from Sanderson et al (2020), available <a href="https://doi.org/10.1093/ije/dyy262">here</a>.</p>
<div id="workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h3>
<p>Fitting and interpreting MVMR models can be achieved by following the 5 steps given below:</p>
<ol style="list-style-type: decimal">
<li>Obtain data</li>
<li>Format data</li>
<li>Assess instrument strength</li>
<li>Assess horizontal pleiotropy</li>
<li>Estimate causal effects</li>
</ol>
<p>Each of these steps are shown in Figure 1, highlighting the R function used for each step.</p>
<p><img src="png/workflow.png" width="600px"></p>
</div>
</div>
<div id="step-1-obtain-summary-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-obtain-summary-data" class="anchor"></a>Step 1: Obtain summary data</h2>
<p>The following information is necessary to estimate causal effects using MVMR:</p>
<ol style="list-style-type: decimal">
<li><p>Gene-exposure associations for each variant selected as an instrument for any exposure.</p></li>
<li><p>Corresponding standard errors for the gene-exposure associations.</p></li>
<li><p>Gene-outcome associations for each instrument.</p></li>
<li><p>Corresponding standard errors for the gene-outcome associations.</p></li>
</ol>
<p>The data frame <code>rawdat_mvmr</code>, included in the <code>MVMR</code> package shows an example of such data obtained from MRBase. In this case, low-density lipoprotein cholesterol (LDL-C), high-density lipoprotein cholesterol (HDL-C), and triglycerides (Trg) have been selected as exposures, while systolic blood pressure (SBP) is the outcome of interest. Here the suffix <code>_beta</code> is used to denote association estimates, while <code>_se</code> denotes standard errors. Please note that the <code>MVMR</code> can take an arbirtary number of exposures (greater than 1), and that three exposures have been selected purely for illustration.</p>
<p>The first 6 rows of <code>rawdat_mvmr</code> are:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/WSpiller/MVMR">MVMR</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">rawdat_mvmr</span><span class="op">)</span></code></pre></div>
<pre><code>##   LDL_beta HDL_beta Trg_beta LDL_se HDL_se Trg_se    SBP_beta     SBP_se
## 1  -0.0270   0.0182   0.0228 0.0046 0.0050 0.0045 -0.00426935 0.00280123
## 2   0.1179   0.0020   0.0379 0.0038 0.0042 0.0039  0.00110389 0.00227690
## 3  -0.0269   0.0079   0.0000 0.0039 0.0042 0.0038 -0.01317370 0.00222743
## 4   0.0081  -0.0508   0.0085 0.0064 0.0069 0.0062 -0.00111303 0.00374264
## 5   0.0191   0.0103  -0.0270 0.0034 0.0036 0.0033 -0.00854986 0.00207701
## 6   0.0043   0.0320   0.0109 0.0038 0.0040 0.0037  0.00472509 0.00237133
##          SNP
## 1 rs10019888
## 2 rs10468017
## 3  rs1047891
## 4 rs10490626
## 5 rs10761762
## 6 rs10832962</code></pre>
<p>Note that the final column <code>SNP</code> contains the rsid numbers for each genetic variant. These are not necessary for conducting MVMR, but assist in follow-up analyses. Summary data for LDL-C, HDL-C, and Triglycerides originate from <a href="https://www.nature.com/articles/ng.2797">GLGC</a>, while SBP data was obtained using <a href="https://www.nature.com/articles/ng.3768">UK Biobank</a>.</p>
<div id="estimating-pairwise-covariances-between-snp-associations" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-pairwise-covariances-between-snp-associations" class="anchor"></a>Estimating pairwise covariances between SNP associations</h3>
<p>The MVMR approach requires pairwise covariances between an instrument and pairs of exposures to be known across all SNPs for accurate estimation and sensitivity analyses, however, this is often not reported in published GWAS analyses. Before continuing with MVMR it is therefore <strong>necessary</strong> to select one of the following three solutions:</p>
<ol style="list-style-type: decimal">
<li>
<p>Estimate the covariance terms using individual level data</p>
<p>If individual level data is available from which the GWAS summary estimates were obtained, the <code><a href="../reference/snpcov_mvmr.html">snpcov_mvmr()</a></code> function can be used to calculate the necessary covariance terms.</p>
</li>
<li>
<p>Estimate the phenotypic correlation between exposures from individual level data</p>
<p>If individual level data is available including phenotypic data, the <code><a href="../reference/phenocov_mvmr.html">phenocov_mvmr()</a></code> function can be used to provide an approximation for the necessary covariance terms.</p>
</li>
<li>
<p>Obtain gene-exposure associations from non-overlapping samples.</p>
<p>If gene-exposure associations are estimated in seperate non-overlapping samples, then the covariances will be zero by design. It is therefore not necessary to calculate the set of covariances, although this approach can be difficult to apply due to a lack of suitable sources of data.</p>
</li>
</ol>
</div>
</div>
<div id="step-2-format-summary-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-format-summary-data" class="anchor"></a>Step 2: Format summary data</h2>
<p>Downstream functions in the <code>MVMR</code> package rely upon prior formatting of raw summary data using the <code><a href="../reference/format_mvmr.html">format_mvmr()</a></code> function. Specifically, <code><a href="../reference/format_mvmr.html">format_mvmr()</a></code> checks and organises summary data columns for use in MVMR analyses. The <code>format_mvmr</code> function takes the following arguments:</p>
<ul>
<li>
<code>BXGs</code>: A subset containing beta-coefficient values for genetic associations with each exposure. Columns should indicate exposure number, with rows representing estimates for a given genetic variant.</li>
<li>
<code>BYG</code>: A numeric vector of beta-coefficient values for genetic associations with the outcome.</li>
<li>
<code>seBXGs</code>: A subset containing standard errors corresponding to the subset of beta-coefficients <code>BXGs</code>.</li>
<li>
<code>seBYG</code>: A numeric vector of standard errors corresponding to the beta-coefficients <code>BYG</code>.</li>
<li>
<code>RSID</code>: A vector of names for genetic variants included in the analysis. If variant IDs are not provided (<code>RSID = "NULL"</code>), a vector of ID numbers will be generated.</li>
</ul>
<p>Using the previous data <code>rawdat.mvmr</code>, we can format the data using the following command:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">F.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_mvmr.html">format_mvmr</a></span><span class="op">(</span>BXGs <span class="op">=</span> <span class="va">rawdat_mvmr</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span>,
                    BYG <span class="op">=</span> <span class="va">rawdat_mvmr</span><span class="op">[</span>,<span class="fl">7</span><span class="op">]</span>,
                    seBXGs <span class="op">=</span> <span class="va">rawdat_mvmr</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>,
                    seBYG <span class="op">=</span> <span class="va">rawdat_mvmr</span><span class="op">[</span>,<span class="fl">8</span><span class="op">]</span>,
                    RSID <span class="op">=</span> <span class="va">rawdat_mvmr</span><span class="op">[</span>,<span class="fl">9</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">F.data</span><span class="op">)</span></code></pre></div>
<pre><code>##          SNP      betaYG   sebetaYG  betaX1  betaX2  betaX3 sebetaX1 sebetaX2
## 1 rs10019888 -0.00426935 0.00280123 -0.0270  0.0182  0.0228   0.0046   0.0050
## 2 rs10468017  0.00110389 0.00227690  0.1179  0.0020  0.0379   0.0038   0.0042
## 3  rs1047891 -0.01317370 0.00222743 -0.0269  0.0079  0.0000   0.0039   0.0042
## 4 rs10490626 -0.00111303 0.00374264  0.0081 -0.0508  0.0085   0.0064   0.0069
## 5 rs10761762 -0.00854986 0.00207701  0.0191  0.0103 -0.0270   0.0034   0.0036
## 6 rs10832962  0.00472509 0.00237133  0.0043  0.0320  0.0109   0.0038   0.0040
##   sebetaX3
## 1   0.0045
## 2   0.0039
## 3   0.0038
## 4   0.0062
## 5   0.0033
## 6   0.0037</code></pre>
<p>In the above code we have provided the numbered columns for each argument. For example, <code>BXGs = rawdat.mvmr[,c(1,2,3)]</code> indicates that columns 1, 2, and 3 are the association estimates for exposures 1, 2, and 3. It is important to note that standard error columns <code>seBXGs</code> should be input in the same order as BXGs to ensure the correct matching of association estimates with corresponding standard errors.</p>
<p>In subsequent steps, each exposure is numbered such that <code>X1</code>, <code>X2</code>, and <code>X3</code> are the first, second, and third entries in the <code>BXGs = rawdat.mvmr[,c(1,2,3)]</code> argument.</p>
</div>
<div id="step-3-test-for-weak-instruments" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-test-for-weak-instruments" class="anchor"></a>Step 3: Test for weak instruments</h2>
<p>In univariate two-sample summary MR, genetic variants selected as instruments are required to be strongly associated with their corresponding exposure. This is quantified by regressing the exposure upon each instrument, and evaluating conditional dependence using the F-statistic for the instrument. Conventionally, a F-statistic greater than 10 is used as a threshold for sufficient instrument strength, representing a 10% relative bias towards the null in the two-sample MR setting.</p>
<p>Multivariable MR relies upon an extension of this assumption, requiring instruments to be strongly associated with their corresponding exposure conditioning on the remaining included exposures. Conditional instrument strength is quantified by a modified F-statistic which has the same distribution as the univariate F-statistic. Consequently, the same conventional instrument strength threshold of 10 can be used.</p>
<p>Further details are available <a href="https://doi.org/10.1093/ije/dyy262">here</a>.</p>
<p>The <code><a href="../reference/strength_mvmr.html">strength_mvmr()</a></code> function is used to evaluate instrument strength in the MVMR setting. The function contains two arguments:</p>
<ul>
<li>
<code>r_input</code>: A formatted data frame created using the <code><a href="../reference/format_mvmr.html">format_mvmr()</a></code> function or an object of class <code>MRMVInput</code> from the <code>mr_mvinput()</code> function in the MendelianRandomization package.</li>
<li>
<code>gencov</code>: A variance-covariance matrix for the effect of the genetic variants on each exposure. This is obtained from either <code><a href="../reference/snpcov_mvmr.html">snpcov_mvmr()</a></code>, <code><a href="../reference/phenocov_mvmr.html">phenocov_mvmr()</a></code>, or set to zero when omitted.</li>
</ul>
<p><strong>Note</strong>: The <code><a href="../reference/strength_mvmr.html">strength_mvmr()</a></code> function will output a warning if a variance-covariance matrix is not provided. Please see Step 1 for further information.</p>
<p>Continuing with the previous example, we can evaluate the conditional strength of the instruments for each exposure using the following command</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/strength_mvmr.html">strength_mvmr</a></span><span class="op">(</span>r_input <span class="op">=</span> <span class="va">F.data</span>, gencov <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Conditional F-statistics for instrument strength
## 
##             exposure1 exposure2 exposure3
## F-statistic  46.33671  67.80463  38.80184</code></pre>
<p>In this case the set of instruments is sufficiently strong for MVMR estimation using the conventional F-statistic threshold of 10. However, note that we have manually set <code>mvmrcov</code> to zero, which would likely not be appropriate given each SNP-exposure estimate eas obtained from the same sample.</p>
</div>
<div id="step-4-test-for-horizontal-pleiotropy" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4-test-for-horizontal-pleiotropy" class="anchor"></a>Step 4: Test for horizontal pleiotropy</h2>
<p>Horizontal pleiotropy can be evaluated using a modified form of Cochran’s Q statistic with respect to differences in MVMR estimates across the set of instruments. In this case, observed heterogeneity is indicative of a violation of the exclusion restriction assumption in MR (validity), which can result in biased effect estimates.</p>
<p>Importantly, weak instruments can increase the false positive rate for pleiotropy detection, as heterogeneity in effect estimates due to weak instrument bias is conflated with heterogeneity as a result of pleiotropic bias. As a correction it is possible to estimate heterogeneity from pleiotropy through Q-statistic minimisation.</p>
<p>The function <code><a href="../reference/pleiotropy_mvmr.html">pleiotropy_mvmr()</a></code> can be used to test for pleiotropy, requiring the same arguments as the <code><a href="../reference/strength_mvmr.html">strength_mvmr()</a></code>; <code>r_input</code> and <code>mvmrcov</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pleiotropy_mvmr.html">pleiotropy_mvmr</a></span><span class="op">(</span>r_input <span class="op">=</span> <span class="va">F.data</span>, gencov <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## Q-Statistic for instrument validity:
## 683.0807 on 141 DF , p-value: 4.880403e-72</code></pre>
</div>
<div id="step-5-estimate-causal-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#step-5-estimate-causal-effects" class="anchor"></a>Step 5: Estimate causal effects</h2>
<p>Two MVMR estimation methods are provided in the <code>MVMR</code> package. The first method fits an inverse variance weighted (IVW) MVMR model, providing estimates of the direct effect of each exposure upon the outcome. This is performed using the <code><a href="../reference/ivw_mvmr.html">ivw_mvmr()</a></code> function as shown below:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ivw_mvmr.html">ivw_mvmr</a></span><span class="op">(</span>r_input <span class="op">=</span> <span class="va">F.data</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Multivariable MR
## 
##               Estimate Std. Error   t value  Pr(&gt;|t|)
## exposure1 -0.021845061 0.01417255 -1.541364 0.1254538
## exposure2  0.003735249 0.01033779  0.361320 0.7183973
## exposure3  0.025572042 0.01601913  1.596344 0.1126351
## 
## Residual standard error: 2.197 on 142 degrees of freedom</code></pre>
<p>In this case, the effect estimates are interpreted as the direct effects of LDL-C (exposure 1), HDL-C (exposure 2), and Trg (exposure 3) on SBP. Estimates are not robust to weak instruments of pleiotropic bias, and therefore rely upon the underlying MVMR assumptions being satisfied.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Wes Spiller, Jack Bowden, Eleanor Sanderson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
